export module 特征类型定义模块;



import 主信息定义模块;
import 语素环境模块;
import <mutex>;


// ==================== 绝对位置与尺寸（世界/相机坐标系） ====================
export inline 词性节点类* 类型_位置X = nullptr;
export inline 词性节点类* 类型_位置Y = nullptr;
export inline 词性节点类* 类型_位置Z = nullptr;
export inline 词性节点类* 类型_尺寸左右 = nullptr; // X轴尺寸（宽度）
export inline 词性节点类* 类型_尺寸上下 = nullptr; // Y轴尺寸（高度）
export inline 词性节点类* 类型_尺寸前后 = nullptr; // Z轴尺寸（深度）

// ==================== 外观与形状特征 ====================
export inline 词性节点类* 类型_平均颜色 = nullptr;
export inline 词性节点类* 类型_轮廓 = nullptr; // 二值轮廓编码（Bits64）
export inline 词性节点类* 类型_三维模型 = nullptr; // ）
// ==================== PCA 主方向（单位向量） ====================
export inline 词性节点类* 类型_主方向1 = nullptr; // PCA 第一主轴
export inline 词性节点类* 类型_主方向2 = nullptr; // PCA 第二主轴
export inline 词性节点类* 类型_主方向3 = nullptr; // PCA 第三主轴

// ==================== 观测质量与可信度特征 ====================
export inline 词性节点类* 类型_观测质量分 = nullptr;
export inline 词性节点类* 类型_深度噪声_MAD = nullptr;
export inline 词性节点类* 类型_PCA残差 = nullptr;
export inline 词性节点类* 类型_颜色一致性 = nullptr;
export inline 词性节点类* 类型_有效点比例 = nullptr; // ==================== 相对位置与尺寸（用于空间关系推理） ====================
export inline 词性节点类* 类型_相对位置X = nullptr;
export inline 词性节点类* 类型_相对位置Y = nullptr;
export inline 词性节点类* 类型_相对位置Z = nullptr;
export inline 词性节点类* 类型_相对尺寸X = nullptr;
export inline 词性节点类* 类型_相对尺寸Y = nullptr;
export inline 词性节点类* 类型_相对尺寸Z = nullptr; // ==================== 绝对位置与尺寸（用于空间关系推理） ====================
export inline 词性节点类* 类型_绝对位置X = nullptr;
export inline 词性节点类* 类型_绝对位置Y = nullptr;
export inline 词性节点类* 类型_绝对位置Z = nullptr;
export inline 词性节点类* 类型_绝对尺寸X = nullptr;
export inline 词性节点类* 类型_绝对尺寸Y = nullptr;
export inline 词性节点类* 类型_绝对尺寸Z = nullptr; // ==================== 轮廓多层金字塔（2D） ====================
// 快速匹配层
export inline 词性节点类* 类型_轮廓_8x8 = nullptr; // Bits64

// 新增：中等分辨率金字塔层（用于二次精确匹配）
export inline 词性节点类* 类型_轮廓金字塔16 = nullptr; // 16x16 → VecI64 (4 uint64_t)
export inline 词性节点类* 类型_轮廓金字塔32 = nullptr; // 32x32 → VecI64 (16 uint64_t)
export inline 词性节点类* 类型_轮廓金字塔64 = nullptr; // 64x64 → VecI64 (64 uint64_t)

// 高精度层（已由 类型_轮廓_全量掩码 覆盖，可选保留别名）

// ==================== 高质量轮廓与边界 ====================
// 新增：3D 反投影轮廓点集（世界坐标或归一化均可）
export inline 词性节点类* 类型_轮廓3D = nullptr; // VecF32 数组

// 新增：原始图像坐标系下的边界点序列（打包 v<<32|u）
export inline 词性节点类* 类型_边界点序列 = nullptr; // VecI64

// ==================== 观测质量与可信度 ====================
// 新增：点簇/观测质量相关标量特征
export inline 词性节点类* 类型_有效点数 = nullptr; // uint32_t 或 I64
export inline 词性节点类* 类型_中位深度 = nullptr; // 米制深度
export inline 词性节点类* 类型_边界噪声 = nullptr; // 深度边缘噪声统计
export inline 词性节点类* 类型_可信度 = nullptr; // 0~1 综合可信度（别名）
export inline 词性节点类* 类型_质量 = nullptr; // 0~1 综合质量分（主用）

// ==================== 可选扩展（预留） ====================
// export inline 词性节点类* const 类型_轮廓_全量掩码     = 语素集.添加词性词("类型_轮廓_全量掩码", "名词");     // Bytes（RLE压缩）
// export inline 词性节点类* const 类型_观测质量分         = 语素集.添加词性词("类型_观测质量分", "名词");         // 与 类型_质量 等价
// ==================== 显示参数（渲染选项/交互） ====================
// 约定：开关类特征用 I64（0/1）；参数类特征用 I64（单位见注释）。

// ---- 开关 ----
export inline 词性节点类* 类型_显示_开关_三维背景 = nullptr;
export inline 词性节点类* 类型_显示_开关_坐标轴 = nullptr;
export inline 词性节点类* 类型_显示_开关_网格地面 = nullptr;
export inline 词性节点类* 类型_显示_开关_相机模型 = nullptr;
export inline 词性节点类* 类型_显示_开关_实时点云 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在框 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在标签 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在点云 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在轮廓 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在ID = nullptr;
export inline 词性节点类* 类型_显示_开关_存在名称 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在大小 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在坐标 = nullptr;
export inline 词性节点类* 类型_显示_开关_存在轨迹 = nullptr;
export inline 词性节点类* 类型_显示_开关_质量信息 = nullptr;
export inline 词性节点类* 类型_显示_开关_视野外淡化 = nullptr; // ---- 参数 ----
// 坐标模式：0=相对坐标(P_rel)，1=绝对坐标(P_abs)，2=双显（优先abs，括号给rel）
export inline 词性节点类* 类型_显示_坐标模式 = nullptr; // 点云采样步长：像素步长（>=1）
export inline 词性节点类* 类型_显示_点云采样步长 = nullptr; // 视野判定参数：FOV（度*100），近/远裁剪（mm）
export inline 词性节点类* 类型_显示_FOV水平_百分度 = nullptr;
export inline 词性节点类* 类型_显示_FOV垂直_百分度 = nullptr;
export inline 词性节点类* 类型_显示_近裁剪_mm = nullptr;
export inline 词性节点类* 类型_显示_远裁剪_mm = nullptr; // 记忆淡化：ms（存在“最后观测时间”到当前帧时间的差）
export inline 词性节点类* 类型_显示_记忆淡化_ms = nullptr; // 轨迹长度：保留多少个轨迹点
export inline 词性节点类* 类型_显示_轨迹长度 = nullptr; // ---- “显示参数抽象概念”对子节点的命名（用作依赖特征类型集合的分组标识） ----
// 这些类型本身不直接参与渲染计算，而是作为“分组节点”的名称，让显示器能从概念树里
// 读出：坐标/尺寸/质量等需要读取的特征类型集合。
export inline 词性节点类* 类型_显示_依赖_坐标_相对 = nullptr;
export inline 词性节点类* 类型_显示_依赖_坐标_绝对 = nullptr;
export inline 词性节点类* 类型_显示_依赖_尺寸_相对 = nullptr;
export inline 词性节点类* 类型_显示_依赖_尺寸_绝对 = nullptr;
export inline 词性节点类* 类型_显示_依赖_朝向 = nullptr;
export inline 词性节点类* 类型_显示_依赖_外观 = nullptr;
export inline 词性节点类* 类型_显示_依赖_质量 = nullptr;
export inline 词性节点类* 类型_显示_依赖_运动 = nullptr;
export inline 词性节点类* 类型_显示_依赖_点簇 = nullptr; // ==================== 运动学（二次特征/显示可用） ====================
// （这些值不一定立刻由提取模块填充，但先把类型固定下来，显示与推理都能复用）
export inline 词性节点类* 类型_速度X = nullptr;
export inline 词性节点类* 类型_速度Y = nullptr;
export inline 词性节点类* 类型_速度Z = nullptr;
export inline 词性节点类* 类型_加速度X = nullptr;
export inline 词性节点类* 类型_加速度Y = nullptr;
export inline 词性节点类* 类型_加速度Z = nullptr; // ==================== 点簇缓存（让“视野外仍可看见”更真实） ====================
// 点簇点云：VecF32，按 [x,y,z,x,y,z,...]（米）或（mm）存储（你在实现时统一约定）
export inline 词性节点类* 类型_点簇点云 = nullptr; // 点簇法线：VecF32，按 [nx,ny,nz,...]
export inline 词性节点类* 类型_点簇法线 = nullptr; // 点簇颜色：Bytes 或 VecI64（按你后续约定）
export inline 词性节点类* 类型_点簇颜色 = nullptr;


// ==================== 初始化（在语素集初始化之后调用） ====================
// 本模块只声明“特征类型指针”，不在静态初始化阶段触发 语素集.添加词性词()，
// 以避免“特征类型定义模块先于语素集初始化”导致的初始化顺序问题。
namespace _特征类型定义模块_细节 {
    inline std::once_flag g_once;
    inline void 初始化_实现()
    {
        if (!类型_位置X) 类型_位置X = 语素集.添加词性词("类型_位置X", "名词");
        if (!类型_位置Y) 类型_位置Y = 语素集.添加词性词("类型_位置Y", "名词");
        if (!类型_位置Z) 类型_位置Z = 语素集.添加词性词("类型_位置Z", "名词");
        if (!类型_尺寸左右) 类型_尺寸左右 = 语素集.添加词性词("类型_尺寸左右", "名词");
        if (!类型_尺寸上下) 类型_尺寸上下 = 语素集.添加词性词("类型_尺寸上下", "名词");
        if (!类型_尺寸前后) 类型_尺寸前后 = 语素集.添加词性词("类型_尺寸前后", "名词");
        if (!类型_平均颜色) 类型_平均颜色 = 语素集.添加词性词("类型_平均颜色", "名词");
        if (!类型_轮廓) 类型_轮廓 = 语素集.添加词性词("类型_轮廓", "名词");
        if (!类型_三维模型) 类型_三维模型 = 语素集.添加词性词("类型_三维模型", "名词");
        if (!类型_主方向1) 类型_主方向1 = 语素集.添加词性词("类型_主方向1", "名词");
        if (!类型_主方向2) 类型_主方向2 = 语素集.添加词性词("类型_主方向2", "名词");
        if (!类型_主方向3) 类型_主方向3 = 语素集.添加词性词("类型_主方向3", "名词");
        if (!类型_观测质量分) 类型_观测质量分 = 语素集.添加词性词("类型_观测质量分", "名词");
        if (!类型_深度噪声_MAD) 类型_深度噪声_MAD = 语素集.添加词性词("类型_深度噪声_MAD", "名词");
        if (!类型_PCA残差) 类型_PCA残差 = 语素集.添加词性词("类型_PCA残差", "名词");
        if (!类型_颜色一致性) 类型_颜色一致性 = 语素集.添加词性词("类型_颜色一致性", "名词");
        if (!类型_有效点比例) 类型_有效点比例 = 语素集.添加词性词("类型_有效点比例", "名词");
        if (!类型_相对位置X) 类型_相对位置X = 语素集.添加词性词("类型_相对位置X", "名词");
        if (!类型_相对位置Y) 类型_相对位置Y = 语素集.添加词性词("类型_相对位置Y", "名词");
        if (!类型_相对位置Z) 类型_相对位置Z = 语素集.添加词性词("类型_相对位置Z", "名词");
        if (!类型_相对尺寸X) 类型_相对尺寸X = 语素集.添加词性词("类型_相对尺寸X", "名词");
        if (!类型_相对尺寸Y) 类型_相对尺寸Y = 语素集.添加词性词("类型_相对尺寸Y", "名词");
        if (!类型_相对尺寸Z) 类型_相对尺寸Z = 语素集.添加词性词("类型_相对尺寸Z", "名词");
        if (!类型_绝对位置X) 类型_绝对位置X = 语素集.添加词性词("类型_绝对位置X", "名词");
        if (!类型_绝对位置Y) 类型_绝对位置Y = 语素集.添加词性词("类型_绝对位置Y", "名词");
        if (!类型_绝对位置Z) 类型_绝对位置Z = 语素集.添加词性词("类型_绝对位置Z", "名词");
        if (!类型_绝对尺寸X) 类型_绝对尺寸X = 语素集.添加词性词("类型_绝对尺寸X", "名词");
        if (!类型_绝对尺寸Y) 类型_绝对尺寸Y = 语素集.添加词性词("类型_绝对尺寸Y", "名词");
        if (!类型_绝对尺寸Z) 类型_绝对尺寸Z = 语素集.添加词性词("类型_绝对尺寸Z", "名词");
        if (!类型_轮廓_8x8) 类型_轮廓_8x8 = 语素集.添加词性词("类型_轮廓_8x8", "名词");
        if (!类型_轮廓金字塔16) 类型_轮廓金字塔16 = 语素集.添加词性词("类型_轮廓金字塔16", "名词");
        if (!类型_轮廓金字塔32) 类型_轮廓金字塔32 = 语素集.添加词性词("类型_轮廓金字塔32", "名词");
        if (!类型_轮廓金字塔64) 类型_轮廓金字塔64 = 语素集.添加词性词("类型_轮廓金字塔64", "名词");
        if (!类型_轮廓3D) 类型_轮廓3D = 语素集.添加词性词("类型_轮廓3D", "名词");
        if (!类型_边界点序列) 类型_边界点序列 = 语素集.添加词性词("类型_边界点序列", "名词");
        if (!类型_有效点数) 类型_有效点数 = 语素集.添加词性词("类型_有效点数", "名词");
        if (!类型_中位深度) 类型_中位深度 = 语素集.添加词性词("类型_中位深度", "名词");
        if (!类型_边界噪声) 类型_边界噪声 = 语素集.添加词性词("类型_边界噪声", "名词");
        if (!类型_可信度) 类型_可信度 = 语素集.添加词性词("类型_可信度", "名词");
        if (!类型_质量) 类型_质量 = 语素集.添加词性词("类型_质量", "名词");
        if (!类型_显示_开关_三维背景) 类型_显示_开关_三维背景 = 语素集.添加词性词("类型_显示_开关_三维背景", "名词");
        if (!类型_显示_开关_坐标轴) 类型_显示_开关_坐标轴 = 语素集.添加词性词("类型_显示_开关_坐标轴", "名词");
        if (!类型_显示_开关_网格地面) 类型_显示_开关_网格地面 = 语素集.添加词性词("类型_显示_开关_网格地面", "名词");
        if (!类型_显示_开关_相机模型) 类型_显示_开关_相机模型 = 语素集.添加词性词("类型_显示_开关_相机模型", "名词");
        if (!类型_显示_开关_实时点云) 类型_显示_开关_实时点云 = 语素集.添加词性词("类型_显示_开关_实时点云", "名词");
        if (!类型_显示_开关_存在框) 类型_显示_开关_存在框 = 语素集.添加词性词("类型_显示_开关_存在框", "名词");
        if (!类型_显示_开关_存在标签) 类型_显示_开关_存在标签 = 语素集.添加词性词("类型_显示_开关_存在标签", "名词");
        if (!类型_显示_开关_存在点云) 类型_显示_开关_存在点云 = 语素集.添加词性词("类型_显示_开关_存在点云", "名词");
        if (!类型_显示_开关_存在轮廓) 类型_显示_开关_存在轮廓 = 语素集.添加词性词("类型_显示_开关_存在轮廓", "名词");
        if (!类型_显示_开关_存在ID) 类型_显示_开关_存在ID = 语素集.添加词性词("类型_显示_开关_存在ID", "名词");
        if (!类型_显示_开关_存在名称) 类型_显示_开关_存在名称 = 语素集.添加词性词("类型_显示_开关_存在名称", "名词");
        if (!类型_显示_开关_存在大小) 类型_显示_开关_存在大小 = 语素集.添加词性词("类型_显示_开关_存在大小", "名词");
        if (!类型_显示_开关_存在坐标) 类型_显示_开关_存在坐标 = 语素集.添加词性词("类型_显示_开关_存在坐标", "名词");
        if (!类型_显示_开关_存在轨迹) 类型_显示_开关_存在轨迹 = 语素集.添加词性词("类型_显示_开关_存在轨迹", "名词");
        if (!类型_显示_开关_质量信息) 类型_显示_开关_质量信息 = 语素集.添加词性词("类型_显示_开关_质量信息", "名词");
        if (!类型_显示_开关_视野外淡化) 类型_显示_开关_视野外淡化 = 语素集.添加词性词("类型_显示_开关_视野外淡化", "名词");
        if (!类型_显示_坐标模式) 类型_显示_坐标模式 = 语素集.添加词性词("类型_显示_坐标模式", "名词");
        if (!类型_显示_点云采样步长) 类型_显示_点云采样步长 = 语素集.添加词性词("类型_显示_点云采样步长", "名词");
        if (!类型_显示_FOV水平_百分度) 类型_显示_FOV水平_百分度 = 语素集.添加词性词("类型_显示_FOV水平_百分度", "名词");
        if (!类型_显示_FOV垂直_百分度) 类型_显示_FOV垂直_百分度 = 语素集.添加词性词("类型_显示_FOV垂直_百分度", "名词");
        if (!类型_显示_近裁剪_mm) 类型_显示_近裁剪_mm = 语素集.添加词性词("类型_显示_近裁剪_mm", "名词");
        if (!类型_显示_远裁剪_mm) 类型_显示_远裁剪_mm = 语素集.添加词性词("类型_显示_远裁剪_mm", "名词");
        if (!类型_显示_记忆淡化_ms) 类型_显示_记忆淡化_ms = 语素集.添加词性词("类型_显示_记忆淡化_ms", "名词");
        if (!类型_显示_轨迹长度) 类型_显示_轨迹长度 = 语素集.添加词性词("类型_显示_轨迹长度", "名词");
        if (!类型_显示_依赖_坐标_相对) 类型_显示_依赖_坐标_相对 = 语素集.添加词性词("类型_显示_依赖_坐标_相对", "名词");
        if (!类型_显示_依赖_坐标_绝对) 类型_显示_依赖_坐标_绝对 = 语素集.添加词性词("类型_显示_依赖_坐标_绝对", "名词");
        if (!类型_显示_依赖_尺寸_相对) 类型_显示_依赖_尺寸_相对 = 语素集.添加词性词("类型_显示_依赖_尺寸_相对", "名词");
        if (!类型_显示_依赖_尺寸_绝对) 类型_显示_依赖_尺寸_绝对 = 语素集.添加词性词("类型_显示_依赖_尺寸_绝对", "名词");
        if (!类型_显示_依赖_朝向) 类型_显示_依赖_朝向 = 语素集.添加词性词("类型_显示_依赖_朝向", "名词");
        if (!类型_显示_依赖_外观) 类型_显示_依赖_外观 = 语素集.添加词性词("类型_显示_依赖_外观", "名词");
        if (!类型_显示_依赖_质量) 类型_显示_依赖_质量 = 语素集.添加词性词("类型_显示_依赖_质量", "名词");
        if (!类型_显示_依赖_运动) 类型_显示_依赖_运动 = 语素集.添加词性词("类型_显示_依赖_运动", "名词");
        if (!类型_显示_依赖_点簇) 类型_显示_依赖_点簇 = 语素集.添加词性词("类型_显示_依赖_点簇", "名词");
        if (!类型_速度X) 类型_速度X = 语素集.添加词性词("类型_速度X", "名词");
        if (!类型_速度Y) 类型_速度Y = 语素集.添加词性词("类型_速度Y", "名词");
        if (!类型_速度Z) 类型_速度Z = 语素集.添加词性词("类型_速度Z", "名词");
        if (!类型_加速度X) 类型_加速度X = 语素集.添加词性词("类型_加速度X", "名词");
        if (!类型_加速度Y) 类型_加速度Y = 语素集.添加词性词("类型_加速度Y", "名词");
        if (!类型_加速度Z) 类型_加速度Z = 语素集.添加词性词("类型_加速度Z", "名词");
        if (!类型_点簇点云) 类型_点簇点云 = 语素集.添加词性词("类型_点簇点云", "名词");
        if (!类型_点簇法线) 类型_点簇法线 = 语素集.添加词性词("类型_点簇法线", "名词");
        if (!类型_点簇颜色) 类型_点簇颜色 = 语素集.添加词性词("类型_点簇颜色", "名词");
    }
}

export inline void 初始化特征类型定义模块_依赖语素()
{
    std::call_once(_特征类型定义模块_细节::g_once, _特征类型定义模块_细节::初始化_实现);
}

